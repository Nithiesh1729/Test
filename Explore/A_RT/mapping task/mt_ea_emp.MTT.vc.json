{
  "name" : "mt_ea_emp",
  "runtimeEnvironmentId" : "@7rGUkpqxviilEt1HC44BQ0",
  "runtimeEnvironmentName" : "A_RT",
  "maxLogs" : 10,
  "parameters" : [
    {
      "name" : "$Source$",
      "type" : "SOURCE",
      "label" : "Source",
      "uiProperties" : {
        "connectionParameterized" : "false",
        "isSelectDistinct" : "false",
        "objectParameterized" : "false",
        "visible" : "false",
        "flags" : "SUPPORTS_MULTI_SCHEMA",
        "originalPath" : "Source"
      },
      "sourceConnectionId" : "@0QBz4VFXOwUeUMezuXY6wA",
      "connectionName" : "SQL_Server_vj",
      "sourceObject" : "DUMMY_Source",
      "newFlatFile" : false,
      "newObject" : false,
      "showBusinessNames" : false,
      "naturalOrder" : true,
      "truncateTarget" : false,
      "bulkApiDBTarget" : false,
      "customFuncCfg" : { },
      "customQuery" : "with core as (\nselect userid,\n    ID_Last_Name,\n    ID_First_Name,\n    alias,\n    preferred_name,\n    store,\n    -- (case \n    --   when department = '9517' then '9501' \n    --   when department = '9519' then '9504' \n    -- else department\n    -- end) \n    -- as \n    department,\n    job_level as job_code,\n    employee_group,\n    job_level as job_grade,\n    job_title,\n    (case \n      when employee_group = 'Office' and emailaddress like '%hk.mcd.com' then emailaddress\n      when department not in ('9517') and emailaddress like '%hk.mcd.com' then emailaddress \n      when department = '9517' and job_level = 'GE-MKT' and employee_group = 'SMT' then emailaddress \n      when department = '9517' and job_level = 'MC-MKT' and employee_group = 'SMT' then emailaddress \n      end) as email_business,\n    '' as email_personal,\n    phone_country_region_code,\n    phonenumber,\n    last_employment_date as termination_date,\n    original_start_date as company_join_date,\n    date_of_birth_mmdd\nFROM M_HR_Personal\nWHERE snapshotdate = '$$p_date'\nand EndDate >= '$$p_date'\nand (last_employment_date >= '$$p_date' or last_employment_date is null)\nand department is not null\n\nUNION ALL\n\nselect *\nfrom M_McClub_RegionalStaff\n)\n,emp_uq as (\n  select userid,\n    count(1) as cn\n  from core\n  group by userid\n  having count(1) > 1\n)\n,bemail_uq as (\n  select email_business,\n    count(1) as cn\n  from core\n  where email_business is not null and trim(email_business) <> ''\n  group by email_business\n  having count(1) > 1\n)\n,pemail_uq as (\n  select email_personal,\n    count(1) as cn\n  from core\n  where email_personal is not null and trim(email_personal) <> ''\n  group by email_personal\n  having count(1) > 1\n)\n,mobile_uq as (\n  select phonenumber,\n    count(1) as cn\n  from core\n  where phonenumber is not null\n    and trim(phonenumber) <> ''\n  group by phonenumber\n  having count(1) > 1\n)\nselect \n    a.userid AS employee_no,\n    ID_Last_Name AS surname,\n    ID_First_Name as given_name,\n    Alias AS alias_name,\n    preferred_name,\n    RIGHT('000000' + Store, 4) as store_no,\n    Department AS dept_code,\n    job_code,\n    employee_group,\n    job_grade,\n    job_title,\n    (case when a.email_business like     '%@hk.mcd.com' then lower(a.email_business) else null end) as email_business,\n    a.email_personal,\n    phone_country_region_code as phone_mobile_country_code,\n    a.phonenumber as phone_mobile,\n    CONVERT(varchar, termination_date, 120) AS termination_date,\n    CONVERT(varchar, company_join_date, 120) AS company_join_date,\n    date_of_birth_mmdd as date_of_birth\n    , (case\n      when b.userid is not null then 0\n      else 1\n    end) as emp_uq\n    , (case\n      when c.email_business is not null then 0\n      else 1\n    end) as bemail_uq\n    , (case\n      when d.email_personal is not null then 0\n      else 1\n    end) as pemail_uq\n    , (case\n      when e.phonenumber is not null then 0\n      else 1\n    end) as mobile_uq\nfrom core a\n  left join emp_uq b on a.userid = b.userid\n  left join bemail_uq c on a.email_business = c.email_business\n  left join pemail_uq d on a.email_personal = d.email_personal\n  left join mobile_uq e on a.phonenumber = e.phonenumber",
      "commandType" : 0,
      "handleSpecialChars" : false,
      "handleDecimalRoundOff" : false,
      "frsAsset" : false,
      "dynamicFileName" : false,
      "excludeDynamicFileNameField" : false,
      "currentlyProcessedFileName" : false,
      "retainFieldMetadata" : false,
      "objectName" : "DUMMY_Source",
      "useExactSrcNames" : false,
      "userUpdated" : true,
      "unspecified" : false,
      "fetchMode" : "ORIGINAL",
      "runtimeParameterData" : {
        "connectionRuntimeParameter" : false,
        "objectRuntimeParameter" : false
      },
      "restmodernSource" : true,
      "fileList" : false
    },
    {
      "name" : "$TargetDummy$",
      "type" : "TARGET",
      "label" : "TargetDummy",
      "uiProperties" : {
        "connectionParameterized" : "false",
        "objectParameterized" : "false",
        "visible" : "false",
        "supportApplyDDLChanges" : "true",
        "originalPath" : "TargetDummy"
      },
      "targetConnectionId" : "@eSHSWsoIe8OerqjiP3liO3",
      "connectionName" : "FlatFile_Vijay",
      "targetObject" : "'Logs\\HR\\EmployeeApp\\EmployListErrorFlag_v2.log'",
      "targetObjectLabel" : "'Logs\\HR\\EmployeeApp\\EmployListErrorFlag_v2.log'",
      "newFlatFile" : false,
      "newObject" : true,
      "showBusinessNames" : false,
      "naturalOrder" : true,
      "newObjectName" : "'Logs\\HR\\EmployeeApp\\EmployListErrorFlag_v2.log'",
      "truncateTarget" : false,
      "bulkApiDBTarget" : false,
      "operationType" : "Insert",
      "tgtFFAttrs" : {
        "delimiter" : "|",
        "textQualifier" : "none",
        "headerLineNo" : 1,
        "rowDelimiter" : 0,
        "consecutiveDelimiter" : false,
        "multiDelimitersAsAnd" : true
      },
      "customFuncCfg" : { },
      "extendedObject" : {
        "singleMode" : true
      },
      "commandType" : 0,
      "handleSpecialChars" : false,
      "handleDecimalRoundOff" : false,
      "frsAsset" : false,
      "dynamicFileName" : false,
      "excludeDynamicFileNameField" : false,
      "currentlyProcessedFileName" : false,
      "retainFieldMetadata" : false,
      "objectName" : "'Logs\\HR\\EmployeeApp\\EmployListErrorFlag_v2.log'",
      "objectLabel" : "'Logs\\HR\\EmployeeApp\\EmployListErrorFlag_v2.log'",
      "useExactSrcNames" : false,
      "userUpdated" : true,
      "unspecified" : false,
      "fetchMode" : "ORIGINAL",
      "runtimeParameterData" : {
        "connectionRuntimeParameter" : false,
        "objectRuntimeParameter" : false
      },
      "restmodernSource" : true,
      "fileList" : false
    },
    {
      "name" : "$TargetInvalid$",
      "type" : "TARGET",
      "label" : "TargetInvalid",
      "uiProperties" : {
        "connectionParameterized" : "false",
        "objectParameterized" : "false",
        "visible" : "false",
        "supportApplyDDLChanges" : "true",
        "originalPath" : "TargetInvalid"
      },
      "targetConnectionId" : "@eSHSWsoIe8OerqjiP3liO3",
      "connectionName" : "FlatFile_Vijay",
      "targetObject" : "'HR\\EmployeeApp\\Employee\\erroremployeeList.csv'",
      "targetObjectLabel" : "'HR\\EmployeeApp\\Employee\\erroremployeeList.csv'",
      "newFlatFile" : false,
      "newObject" : true,
      "showBusinessNames" : false,
      "naturalOrder" : true,
      "newObjectName" : "'HR\\EmployeeApp\\Employee\\erroremployeeList.csv'",
      "truncateTarget" : false,
      "bulkApiDBTarget" : false,
      "operationType" : "Insert",
      "tgtFFAttrs" : {
        "delimiter" : ",",
        "textQualifier" : "none",
        "headerLineNo" : 1,
        "rowDelimiter" : 0,
        "consecutiveDelimiter" : false,
        "multiDelimitersAsAnd" : true
      },
      "customFuncCfg" : { },
      "extendedObject" : {
        "singleMode" : true
      },
      "commandType" : 0,
      "handleSpecialChars" : false,
      "handleDecimalRoundOff" : false,
      "frsAsset" : false,
      "dynamicFileName" : false,
      "excludeDynamicFileNameField" : false,
      "currentlyProcessedFileName" : false,
      "retainFieldMetadata" : false,
      "objectName" : "'HR\\EmployeeApp\\Employee\\erroremployeeList.csv'",
      "objectLabel" : "'HR\\EmployeeApp\\Employee\\erroremployeeList.csv'",
      "useExactSrcNames" : false,
      "userUpdated" : true,
      "unspecified" : false,
      "fetchMode" : "ORIGINAL",
      "runtimeParameterData" : {
        "connectionRuntimeParameter" : false,
        "objectRuntimeParameter" : false
      },
      "restmodernSource" : true,
      "fileList" : false
    },
    {
      "name" : "$TargetValid$",
      "type" : "TARGET",
      "label" : "TargetValid",
      "uiProperties" : {
        "connectionParameterized" : "false",
        "objectParameterized" : "false",
        "visible" : "false",
        "supportApplyDDLChanges" : "true",
        "originalPath" : "TargetValid"
      },
      "targetConnectionId" : "@eSHSWsoIe8OerqjiP3liO3",
      "connectionName" : "FlatFile_Vijay",
      "targetObject" : "'HR\\EmployeeApp\\Employee\\employeeList.psv'",
      "targetObjectLabel" : "'HR\\EmployeeApp\\Employee\\employeeList.psv'",
      "newFlatFile" : false,
      "newObject" : true,
      "showBusinessNames" : false,
      "naturalOrder" : true,
      "newObjectName" : "'HR\\EmployeeApp\\Employee\\employeeList.psv'",
      "truncateTarget" : false,
      "bulkApiDBTarget" : false,
      "operationType" : "Insert",
      "tgtFFAttrs" : {
        "delimiter" : "|",
        "textQualifier" : "none",
        "headerLineNo" : 1,
        "rowDelimiter" : 0,
        "consecutiveDelimiter" : false,
        "multiDelimitersAsAnd" : true
      },
      "customFuncCfg" : { },
      "extendedObject" : {
        "singleMode" : true
      },
      "commandType" : 0,
      "handleSpecialChars" : false,
      "handleDecimalRoundOff" : false,
      "frsAsset" : false,
      "dynamicFileName" : false,
      "excludeDynamicFileNameField" : false,
      "currentlyProcessedFileName" : false,
      "retainFieldMetadata" : false,
      "objectName" : "'HR\\EmployeeApp\\Employee\\employeeList.psv'",
      "objectLabel" : "'HR\\EmployeeApp\\Employee\\employeeList.psv'",
      "useExactSrcNames" : false,
      "userUpdated" : true,
      "unspecified" : false,
      "fetchMode" : "ORIGINAL",
      "runtimeParameterData" : {
        "connectionRuntimeParameter" : false,
        "objectRuntimeParameter" : false
      },
      "restmodernSource" : true,
      "fileList" : false
    }
  ],
  "verbose" : false,
  "mappingId" : "@7AVJRqEK7YWhrWxO4q9FeO",
  "mappingTemplateName" : "m_ea_emp",
  "inOutParameters" : [
    {
      "name" : "ErrorCount",
      "datatype" : "INTEGER",
      "precision" : "10",
      "scale" : "0",
      "retentionPolicy" : "ON_SUCCESS_OR_WARNING",
      "aggregationType" : "MAX"
    },
    {
      "name" : "p_date",
      "initialValue" : "20241202",
      "datatype" : "STRING",
      "precision" : "10",
      "scale" : "0",
      "retentionPolicy" : "ON_SUCCESS_OR_WARNING",
      "aggregationType" : "MAX",
      "currentValue" : "20241202"
    }
  ],
  "hidden" : false,
  "enableCrossSchemaPushdown" : false,
  "enableParallelRun" : false,
  "autoTunedApplied" : false,
  "autoTunedAppliedType" : "NONE",
  "schemaMode" : "async",
  "valid" : true,
  "optimizationPlan" : "NONE",
  "allowMaxFieldLength" : false,
  "midstreamPreview" : false,
  "vcsExportTime" : "2025-04-23 04:07:09 PDT"
}